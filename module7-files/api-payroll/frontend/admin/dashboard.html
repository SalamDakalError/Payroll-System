<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <title>Admin Dashboard - Fast-Food Payroll</title>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><div class="logo">A</div><h1>Payroll â€” Admin</h1></div>
      <div class="nav"><a class="btn" href="users.html">Users</a><a class="btn secondary" href="change-password.html">Change Password</a><a class="btn secondary" href="../../auth/logout.php">Logout</a></div>
    </div>

    <div class="grid" style="margin-bottom:16px">
      <div class="col-3 card kpi">
        <div class="label">Total Users</div>
        <div class="value" id="totalUsers">0</div>
        <div class="small">Active users in system</div>
      </div>
      <div class="col-3 card kpi">
        <div class="label">Employees</div>
        <div class="value" id="totalEmployees">0</div>
        <div class="small">Active employees</div>
      </div>
      <div class="col-3 card kpi">
        <div class="label">Managers</div>
        <div class="value" id="totalManagers">0</div>
        <div class="small">Active managers</div>
      </div>
      <div class="col-3 card kpi">
        <div class="label">Total Payroll This Month</div>
        <div class="value" id="totalPayroll">$0.00</div>
        <div class="small">Net payroll total</div>
      </div>
    </div>

    <div class="grid">
      <div class="col-9 card">
        <h3>Recent Employees</h3>
        <table>
          <thead><tr><th>Name</th><th>Job Title</th><th>Hourly Rate</th></tr></thead>
          <tbody id="recentEmployeesTable">
            <tr><td colspan="3">Loading...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="col-3 card">
        <h4>Quick Actions</h4>
        <div class="actions">
          <a class="btn" href="add-user.html">Add User</a>
          <a class="btn" href="users.html">Manage Users</a>
        </div>
      </div>
    </div>
  </div>
  <script src="../assets/js/main.js"></script>
  <script>
    // Load dashboard stats
    function loadDashboardStats() {
      apiFetch('../../dashboard/stats.php').then(data => {
        if (data && data.success) {
          document.getElementById('totalUsers').textContent = data.stats.total_users;
          document.getElementById('totalEmployees').textContent = data.stats.total_employees;
          document.getElementById('totalManagers').textContent = data.stats.total_managers;
          document.getElementById('totalPayroll').textContent = '$' + data.stats.total_payroll;
        }
      });
    }

    // Load recent employees
    function loadRecentEmployees() {
      apiFetch('../../dashboard/recent-employees.php').then(data => {
        const tbody = document.getElementById('recentEmployeesTable');
        if (data && data.success && data.employees) {
          if (data.employees.length > 0) {
            tbody.innerHTML = data.employees.map(emp =>
              `<tr><td>${emp.name}</td><td>${emp.job_title || 'Not assigned'}</td><td>$${parseFloat(emp.pay_rate || 0).toFixed(2)}</td></tr>`
            ).join('');
          } else {
            tbody.innerHTML = '<tr><td colspan="3">No employees found</td></tr>';
          }
        } else {
          tbody.innerHTML = '<tr><td colspan="3">Error loading employees</td></tr>';
        }
      });
    }

    // Load data when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadDashboardStats();
      loadRecentEmployees();
    });
  </script>
</body>
</html>
