<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <title>Change Password</title>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><div class="logo">CP</div><h1>Change Password</h1></div>
      <div class="nav"><a class="btn" href="dashboard.html">Dashboard</a><a class="btn secondary" href="../../auth/logout.php">Logout</a></div>
    </div>

    <div class="card">
      <h3>Change Your Password</h3>
      <form id="changePasswordForm" style="display:flex;flex-direction:column;gap:10px;max-width:400px">
        <input class="form-control" name="current_password" type="password" placeholder="Current Password" required />
        <input class="form-control" name="new_password" type="password" placeholder="New Password" required />
        <input class="form-control" name="confirm_password" type="password" placeholder="Confirm New Password" required />
        <button class="btn" type="submit">Change Password</button>
      </form>
      <div id="message" style="margin-top:10px;"></div>
    </div>
  </div>
  <script src="../assets/js/main.js"></script>
  <script>
    document.getElementById('changePasswordForm').addEventListener('submit', async e => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const body = {
        current_password: fd.get('current_password'),
        new_password: fd.get('new_password'),
        confirm_password: fd.get('confirm_password')
      };

      if (body.new_password !== body.confirm_password) {
        document.getElementById('message').innerHTML = '<div class="alert alert-danger">New passwords do not match.</div>';
        return;
      }

      const res = await apiFetch('change-password.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      if (res && res.success) {
        document.getElementById('message').innerHTML = '<div class="alert alert-success">Password changed successfully.</div>';
        e.target.reset();
      } else {
        document.getElementById('message').innerHTML = '<div class="alert alert-danger">' + (res.message || 'Failed to change password.') + '</div>';
      }
    });
  </script>
</body>
</html>