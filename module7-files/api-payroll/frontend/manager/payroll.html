<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <title>Payroll Records</title>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><div class="logo">P</div><h1>Payroll Records</h1></div>
      <div class="nav"><a class="btn" href="dashboard.html">Dashboard</a><a class="btn secondary" href="employees.html">Employees</a><a class="btn secondary" href="payroll-entry.html">Payroll Entry</a><a class="btn secondary" href="../../auth/logout.php">Logout</a></div>
    </div>

    <div class="card" style="margin-bottom:16px;text-align:center">
      <h3>Payroll Management</h3>
      <p>View existing payroll records or create new entries.</p>
      <a class="btn" href="payroll-entry.html">Add New Payroll Entry</a>
    </div>

    <div class="card">
      <h3>Recent Payroll Records</h3>
      <table>
        <thead>
          <tr>
            <th>Employee</th>
            <th>Pay Period</th>
            <th>Hours Worked</th>
            <th>Gross Pay</th>
            <th>Net Salary</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="recentPayrollTable">
          <tr><td colspan="6">Loading payroll records...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script src="../assets/js/main.js"></script>
  <script>
    async function loadRecentPayroll() {
      try {
        const response = await fetch('../../payroll/read-all.php');
        const result = await response.json();
        if (result.success) {
          renderRecentPayrollTable(result.records);
        }
      } catch (error) {
        console.error('Error loading payroll:', error);
      }
    }

    function renderRecentPayrollTable(records) {
      const tbody = document.getElementById('recentPayrollTable');
      if (!records || records.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No payroll records found</td></tr>';
        return;
      }

      tbody.innerHTML = records.map(record => {
        const statusClass = record.payslip_status === 'issued' ? 'present' : 'absent';
        const statusText = record.payslip_status === 'issued' ? 'Issued' : 'Pending';
        return `
          <tr>
            <td>${record.employee_name}</td>
            <td>${record.pay_period}</td>
            <td>${record.hours_worked || record.total_hours || 'N/A'}</td>
            <td>$${parseFloat(record.gross_pay).toFixed(2)}</td>
            <td>$${parseFloat(record.net_pay).toFixed(2)}</td>
            <td><span class="badge ${statusClass}">${statusText}</span></td>
          </tr>
        `;
      }).join('');
    }

    // Load data when page loads
    loadRecentPayroll();
  </script>
</body>
</html>