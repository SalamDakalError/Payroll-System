<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <title>My Payroll</title>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><div class="logo">EMP</div><h1>My Payroll</h1></div>
      <div class="nav"><a class="btn secondary" href="dashboard.html">Dashboard</a><a class="btn secondary" href="../../auth/logout.php">Logout</a></div>
    </div>

    <div class="card">
      <h3>My Payroll Records</h3>
      <table><thead><tr><th>Pay Period</th><th>Total Hours</th><th>Gross Pay</th><th>Deductions</th><th>Net Pay</th></tr></thead>
      <tbody id="payroll-table"><tr><td colspan="5">Loading...</td></tr></tbody></table>
    </div>
  </div>
  <script src="../assets/js/main.js"></script>
  <script>
    // Load payroll for current employee
    fetch('/Payroll-System/module7-files/api-payroll/auth/check-session.php')
      .then(response => response.json())
      .then(data => {
        if (data.logged_in && data.user.role_id == 3) {
          // Load payroll records for current user
          return fetch('/Payroll-System/module7-files/api-payroll/payroll/read-current.php');
        } else {
          throw new Error('Not logged in as employee');
        }
      })
      .then(response => response.json())
      .then(data => {
        const tbody = document.getElementById('payroll-table');
        if (data.success && data.records.length > 0) {
          tbody.innerHTML = data.records.map(p =>
            `<tr>
              <td>${p.pay_period}</td>
              <td>${parseFloat(p.total_hours || 0).toFixed(2)}</td>
              <td>$${parseFloat(p.gross_pay || 0).toFixed(2)}</td>
              <td>$${parseFloat(p.deductions || 0).toFixed(2)}</td>
              <td>$${parseFloat(p.net_pay || 0).toFixed(2)}</td>
            </tr>`
          ).join('');
        } else {
          tbody.innerHTML = '<tr><td colspan="5">No payroll records found</td></tr>';
        }
      })
      .catch(error => {
        console.error('Error loading payroll:', error);
        document.getElementById('payroll-table').innerHTML = '<tr><td colspan="5">Error loading payroll records</td></tr>';
      });
  </script>
</body>
</html>